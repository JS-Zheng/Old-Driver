{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/utils/LPCodeHelper.js","webpack:///./src/odml/Node.js","webpack:///./src/odml/OdmlParser.js","webpack:///./src/utils/ElementProtoManager.js","webpack:///./src/OldDriverHandler.js","webpack:///./src/index.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","LPCodeHelper","[object Object]","code","length","Node","constructor","tagName","content","this","OdmlParser","groupTags","txt","match","parseTag","tag","trim","ElementProtoManager","clzPrefix","prefix","nativeElsProto","componentsProto","getProto","isNativeEl","setProto","proto","createElementWithClz","clzName","noPrefix","createElement","getPrefixClzName","classList","add","cloneNode","document","addPrefixClzToElement","el","dev","NODE_ENV","OldDriverHandler","elProtoManager","observe","contentArea","getElementById","handleParagraphs","getElementsByTagName","paras","odmlParser","Array","from","forEach","style","backgroundColor","tags","innerText","fragment","createDocumentFragment","appendChild","elements","node","split","src","restoreLink","console","log","push","container","wrapper","parentNode","APP_NAME","APP_VERSION","odHandler","timer","odSetInterval","window","setInterval","odClearInterval","clearInterval","st","ct","pS","history","pushState","rS","replaceState","apply","arguments","addEventListener","registerHistoryListener"],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","// LowProfileCode: 低調碼\nclass LPCodeHelper {\n\n  static restoreLink(code) {\n    if (code == null) return '#'\n    switch (code.length) {\n      case 5:\n        return 'http://0rz.tw/' + code\n      case 6:\n        return 'https://goo.gl/' + code\n      case 8:\n        return 'https://tinyurl.com/' + code\n      default:\n        return '#'\n    }\n  }\n}\n\nexport default LPCodeHelper","class Node {\n  constructor(tagName, content) {\n    this.tagName = tagName\n    this.content = content\n  }\n}\n\nexport default Node","import Node from './Node'\n\nclass OdmlParser {\n\n  groupTags(txt) {\n    return txt.match(/\\[\\s*([A-Za-z]+)\\s*]([\\S\\s,]+?)\\[\\/\\s*([A-Za-z]+)+\\s*]/g)\n  }\n\n  parseTag(tag) {\n    let m = tag.match(/\\[\\s*(img|video|iframe+)\\s*]([\\S\\s,]+?)\\[\\/\\s*(img|video|iframe+)\\s*]/)\n    if (m == null || m.length < 3 || m[1] !== m[3]) return\n    let tagName = m[1].trim()\n    let content = m[2].trim()\n    return new Node(tagName, content)\n  }\n}\n\nexport default OdmlParser","class ElementProtoManager {\n\n  constructor(clzPrefix) {\n    this.prefix = clzPrefix;\n    this.nativeElsProto = {}\n    this.componentsProto = {}\n  }\n\n  getProto(key, isNativeEl = false) {\n    if (isNativeEl) return this.nativeElsProto[key];\n    return this.componentsProto[key]\n  }\n\n  setProto(key, proto, isNativeEl = false) {\n    if (isNativeEl)\n      this.nativeElsProto[key] = proto;\n    else\n      this.componentsProto[key] = proto;\n  }\n\n  createElementWithClz(tagName, clzName = null, noPrefix = false) {\n    const key = '' + tagName + clzName + noPrefix;\n    let proto = this.getProto(key);\n\n    if (!proto) {\n      proto = this.createElement(tagName);\n      if (clzName) {\n        clzName = noPrefix ? clzName : this.getPrefixClzName(clzName);\n        proto.classList.add(clzName);\n      }\n      this.setProto(key, proto);\n    }\n\n    return proto.cloneNode(false);\n  }\n\n  createElement(tagName) {\n    let proto = this.getProto(tagName, true);\n    if (!proto) {\n      proto = document.createElement(tagName);\n      this.setProto(tagName, proto, true);\n    }\n    return proto.cloneNode(false);\n  }\n\n  getPrefixClzName(clzName) {\n    if (this.prefix == null || this.prefix === \"\") return clzName;\n    return this.prefix + \"-\" + clzName;\n  }\n\n  addPrefixClzToElement(el, clzName) {\n    el.classList.add(this.getPrefixClzName(clzName));\n  }\n}\n\nexport default ElementProtoManager","import LPCodeHelper from \"./utils/LPCodeHelper\";\nimport OdmlParser from \"./odml/OdmlParser\";\nimport ElementProtoManager from \"./utils/ElementProtoManager\";\n\nlet NODE_ENV = process.env.NODE_ENV\nlet dev = NODE_ENV !== 'production';\n\nclass OldDriverHandler {\n\n  constructor() {\n    this.elProtoManager = new ElementProtoManager(\"od\");\n  }\n\n  observe() {\n    let contentArea = document.getElementById(\"contentArea\")\n    // Handle existing posts\n    this.handleParagraphs(contentArea.getElementsByTagName(\"p\"))\n  }\n\n  handleParagraphs(paras) {\n    if (paras == null || paras.length === 0) return\n\n    this.odmlParser = new OdmlParser();\n\n    Array.from(paras).forEach(p => {\n        if (dev) p.style.backgroundColor = \"#f56\"\n        let tags = this.odmlParser.groupTags(p.innerText)\n        if (tags == null || tags.length < 1) return\n        // Clear text of p\n        p.innerText = \"\"\n\n        let fragment = document.createDocumentFragment()\n        fragment.appendChild(this.elProtoManager.createElement(\"br\"))\n\n        let elements = []\n        for (let i = 0, tag; tag = tags[i]; i++) {\n          let node = this.odmlParser.parseTag(tag)\n          let tagName = node.tagName\n          let codes = node.content.split(\",\")\n\n          codes.forEach(c => {\n            c = c.trim()\n            let src = LPCodeHelper.restoreLink(c)\n            if (dev) console.log(`Restore [${c}]: ${src}`)\n            let el = this.elProtoManager.createElementWithClz(tagName, \"item\")\n            el.src = src\n            el.classList.add(\"swiper-slide\");\n            elements.push(el)\n          })\n        }\n\n        let container = this.elProtoManager.createElement(\"div\")\n        // todo: append to swiper\n        elements.forEach(el => {\n          let wrapper = this.elProtoManager.createElement(\"div\")\n          wrapper.appendChild(el)\n          container.appendChild(wrapper)\n        })\n\n        fragment.appendChild(container)\n        p.parentNode.appendChild(fragment)\n      }\n    )\n  }\n}\n\nexport default OldDriverHandler","import OldDriverHandler from \"./OldDriverHandler\";\n\nlet NODE_ENV = process.env.NODE_ENV\nlet dev = NODE_ENV !== 'production';\nif (dev) console.log(`==== ${APP_NAME} ${NODE_ENV} v${APP_VERSION} ====`);\n\nlet odHandler = new OldDriverHandler();\n\n// Save native setInterval(), clearInterval()\nlet timer = null;\nlet odSetInterval = window[\"__fbNativeSetInterval\"] ? window[\"__fbNativeSetInterval\"] : window.setInterval;\nlet odClearInterval = window[\"__fbNativeClearInterval\"] ? window[\"__fbNativeClearInterval\"] : window.clearInterval;\nwindow.st = odSetInterval\nwindow.ct = odClearInterval\n\nregisterHistoryListener()\nobserve()\n\nfunction registerHistoryListener() {\n  let pS = window.history.pushState;\n  let rS = window.history.replaceState;\n\n  window.history.pushState = function () {\n    if (dev) console.log(\"pushState\")\n    observe()\n    pS.apply(this, arguments);\n  }\n\n  window.history.replaceState = function () {\n    if (dev) console.log(\"replaceState\")\n    observe()\n    rS.apply(this, arguments);\n  }\n\n  window.addEventListener(\"popstate\", function () {\n    if (dev) console.log(\"popstate\")\n    observe()\n  });\n}\n\nfunction observe() {\n  if (timer) odClearInterval(timer)\n  timer = odSetInterval(() => {\n    odHandler.observe();\n  }, 1000)\n}\n"],"sourceRoot":""}